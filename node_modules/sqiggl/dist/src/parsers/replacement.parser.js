var parser_1 = require('../parser');
var expression_tree_parser_1 = require('./expression.tree.parser');
/**
 * The parser responsible for all DSLReplacements.
 *
 * @internal
 */
var ReplacementParser = (function () {
    /**
     * Creates a new instance of ReplacementParser
     *
     * @internal
     * @param options {ParserOptions} - The {@link ParserOptions} for string output.
     */
    function ReplacementParser(options) {
        this.options = options;
    }
    /**
     * Take a DSLReplacement, run any expressions against it, and output the final string.
     *
     * @internal
     * @param dsl {DSLReplacement} - The DSL to parse.
     * @param variables {ScopedVariables} - The list of known variables for this scope.
     * @returns {string} - The final output string for this replacement.
     */
    ReplacementParser.prototype.parse = function (dsl, variables) {
        var output, result;
        if (!!dsl.expressions) {
            result = new expression_tree_parser_1.ExpressionTreeParser(this.options).parse(dsl.expressions, variables);
            if (!!result.iterable) {
                output = result.value.join(parser_1.Parser.resolveValue(result.iterable.joiner, variables) + " ");
            }
            else {
                output = result.value;
            }
        }
        else {
            output = parser_1.Parser.resolveValue(dsl.literal, variables).toString();
        }
        if (output === true)
            return this.options.trueString;
        if (output === false)
            return this.options.falseString;
        return output;
    };
    return ReplacementParser;
})();
exports.ReplacementParser = ReplacementParser;
